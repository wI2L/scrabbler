package cmd

import (
	"bytes"
	"compress/gzip"
	_ "embed"
	"slices"

	"golang.org/x/text/language"
)

const (
	blank          = "?"
	defaultDistrib = "french" // üá´üá∑
)

// letter represents a Scrabble letter.
// It can either be a single rune or a sequence of
// several runes to represent a digraph.
type letter struct {
	L         string
	frequency uint
	points    uint
}

// distribution maps the letters of a Scrabble game for
// a particular language to their frequency and points.
type distribution struct {
	lang    language.Tag
	dict    []byte
	letters []letter
}

func (d distribution) dictionary() (indexedDict, error) {
	if d.dict == nil {
		return nil, nil
	}
	r, err := gzip.NewReader(bytes.NewReader(d.dict))
	if err != nil {
		return nil, err
	}
	return parseDictionary(r)
}

func (d distribution) alphabet() []string {
	a := make([]string, 0, len(d.letters))
	for _, v := range d.letters {
		if v.L == blank {
			continue
		}
		a = append(a, v.L)
	}
	slices.Sort(a)

	return a
}

// french represents the distribution of letters for the
// French edition. It contains 102 tiles.
// https://en.wikipedia.org/wiki/Scrabble_letter_distributions#French
// +----+-----------+---------+-----+----+-------------+----+----+-----+
// |    | √ó1        | √ó2      | √ó3  | √ó5 | √ó6          | √ó8 | √ó9 | √ó15 |
// +----+-----------+---------+-----+----+-------------+----+----+-----+
// | 0  |           | [blank] |     |    |             |    |    |     |
// | 1  |           |         |     | L  | N O R S T U | I  | A  | E   |
// | 2  |           | G       | D M |    |             |    |    |     |
// | 3  |           | B C P   |     |    |             |    |    |     |
// | 4  |           | F H V   |     |    |             |    |    |     |
// | 8  | J Q       |         |     |    |             |    |    |     |
// | 10 | K W X Y Z |         |     |    |             |    |    |     |
// +----+-----------+---------+-----+----+-------------+----+----+-----+
var french = distribution{
	lang: language.French,
	dict: ods8,
	letters: []letter{
		{blank, 2, 0},
		{"A", 9, 1},
		{"B", 2, 3},
		{"C", 2, 3},
		{"D", 3, 2},
		{"E", 15, 1},
		{"F", 2, 4},
		{"G", 2, 2},
		{"H", 2, 4},
		{"I", 8, 1},
		{"J", 1, 8},
		{"K", 1, 10},
		{"L", 5, 1},
		{"M", 3, 2},
		{"N", 6, 1},
		{"O", 6, 1},
		{"P", 2, 3},
		{"Q", 1, 8},
		{"R", 6, 1},
		{"S", 6, 1},
		{"T", 6, 1},
		{"U", 6, 1},
		{"V", 2, 4},
		{"W", 1, 10},
		{"X", 1, 10},
		{"Y", 1, 10},
		{"Z", 1, 10},
	},
}

// english represents the distribution of letters for the
// standard English edition. It contains 100 tiles.
// https://en.wikipedia.org/wiki/Scrabble_letter_distributions#English
// +----+-----+-----------+----+-------+-------+----+-----+-----+
// |    | √ó1  | √ó2        | √ó3 | √ó4    | √ó6    | √ó8 | √ó9  | √ó12 |
// +----+-----+-----------+----+-------+-------+----+-----+-----+
// | 0  |     | [blank]   |    |       |       |    |     |     |
// | 1  |     |           |    | L S U | N R T | O  | A I | E   |
// | 2  |     |           | G  | D     |       |    |     |     |
// | 3  |     | B C M P   |    |       |       |    |     |     |
// | 4  |     | F H V W Y |    |       |       |    |     |     |
// | 5  | K   |           |    |       |       |    |     |     |
// | 8  | J X |           |    |       |       |    |     |     |
// | 10 | Q Z |           |    |       |       |    |     |     |
// +----+-----+-----------+----+-------+-------+----+-----+-----+
var english = distribution{
	lang: language.English,
	dict: sowpods,
	letters: []letter{
		{blank, 2, 0},
		{"A", 9, 1},
		{"B", 2, 3},
		{"C", 2, 3},
		{"D", 4, 2},
		{"E", 12, 1},
		{"F", 2, 4},
		{"G", 3, 2},
		{"H", 2, 4},
		{"I", 9, 1},
		{"J", 1, 8},
		{"K", 1, 5},
		{"L", 4, 1},
		{"M", 2, 3},
		{"N", 6, 1},
		{"O", 8, 1},
		{"P", 2, 3},
		{"Q", 1, 10},
		{"R", 6, 1},
		{"S", 4, 1},
		{"T", 6, 1},
		{"U", 4, 1},
		{"V", 2, 4},
		{"W", 2, 4},
		{"X", 1, 8},
		{"Y", 2, 4},
		{"Z", 1, 10},
	},
}

// german represents the distribution of letters for the
// standard German edition. It contains 102 tiles.
// https://en.wikipedia.org/wiki/Scrabble_letter_distributions#German
// +----+---------+---------+-------+----+----+---------+----+----+-----+
// |    | √ó1      | √ó2      | √ó3    | √ó4 | √ó5 | √ó6      | √ó7 | √ó9 | √ó15 |
// +----+---------+---------+-------+----+----+---------+----+----+-----+
// | 0  |         | [blank] |       |    |    |         |    |    |     |
// | 1  |         |         |       | D  | A  | I R T U | S  | N  | E   |
// | 2  |         |         | G L O | H  |    |         |    |    |     |
// | 3  | W Z     | B       |       | M  |    |         |    |    |     |
// | 4  | P       | C F K   |       |    |    |         |    |    |     |
// | 6  | √Ñ J √ú V |         |       |    |    |         |    |    |     |
// | 8  | √ñ X     |         |       |    |    |         |    |    |     |
// | 10 | Q Y     |         |       |    |    |         |    |    |     |
// +----+---------+---------+-------+----+----+---------+----+----+-----+
var german = distribution{
	lang: language.German,
	letters: []letter{
		{blank, 2, 0},
		{"A", 5, 1},
		{"B", 2, 3},
		{"C", 2, 4},
		{"D", 4, 1},
		{"E", 15, 1},
		{"F", 2, 4},
		{"G", 3, 2},
		{"H", 4, 2},
		{"I", 6, 1},
		{"J", 1, 6},
		{"K", 2, 4},
		{"L", 3, 2},
		{"M", 4, 3},
		{"N", 9, 1},
		{"O", 3, 2},
		{"P", 1, 6},
		{"Q", 1, 10},
		{"R", 6, 1},
		{"S", 7, 1},
		{"T", 6, 1},
		{"U", 6, 1},
		{"V", 1, 6},
		{"W", 1, 3},
		{"X", 1, 8},
		{"Y", 1, 10},
		{"Z", 1, 3},
		{"√Ñ", 1, 6},
		{"√ñ", 1, 8},
		{"√ú", 1, 6},
	},
}

// italian represents the distribution of letters for the
// standard Italian edition. It contains 120 tiles.
// https://en.wikipedia.org/wiki/Scrabble_letter_distributions#Italian
// +----+----+---------+-----------+---------+---------+-----+-----+-----+-----+
// |    | √ó1 | √ó2      | √ó3        | √ó5      | √ó6      | √ó11 | √ó12 | √ó14 | √ó15 |
// +----+----+---------+-----------+---------+---------+-----+-----+-----+-----+
// | 0  |    | [blank] |           |         |         |     |     |     |     |
// | 1  |    |         |           |         |         | E   | I   | A   | O   |
// | 2  |    |         |           |         | C R S T |     |     |     |     |
// | 3  |    |         |           | L M N U |         |     |     |     |     |
// | 5  |    |         | B D F P V |         |         |     |     |     |     |
// | 8  |    | G H Z   |           |         |         |     |     |     |     |
// | 10 | Q  |         |           |         |         |     |     |     |     |
// +----+----+---------+-----------+---------+---------+-----+-----+-----+-----+
var italian = distribution{
	lang: language.Italian,
	letters: []letter{
		{blank, 2, 0},
		{"A", 14, 1},
		{"B", 3, 5},
		{"C", 6, 2},
		{"D", 3, 5},
		{"E", 11, 1},
		{"F", 3, 5},
		{"G", 2, 8},
		{"H", 2, 8},
		{"I", 12, 1},
		{"L", 5, 3},
		{"M", 5, 3},
		{"N", 5, 3},
		{"O", 15, 1},
		{"P", 3, 5},
		{"Q", 1, 10},
		{"R", 6, 2},
		{"S", 6, 2},
		{"T", 6, 2},
		{"U", 5, 3},
		{"V", 3, 5},
		{"Z", 2, 8},
	},
}

// dutch represents the distribution of letters for the
// standard Dutch edition. It contains 102 tiles.
// https://en.wikipedia.org/wiki/Scrabble_letter_distributions#Dutch
// +----+-----+-----------+---------+----+---------+-----+-----+-----+
// |    | √ó1  | √ó2        | √ó3      | √ó4 | √ó5      | √ó6  | √ó10 | √ó18 |
// +----+-----+-----------+---------+----+---------+-----+-----+-----+
// | 0  |     | [blank]   |         |    |         |     |     |     |
// | 1  |     |           |         | I  |         | A O | N   | E   |
// | 2  |     |           |         |    | D R S T |     |     |     |
// | 3  |     | B P       | G K L M |    |         |     |     |     |
// | 4  |     | F H J V Z | U       |    |         |     |     |     |
// | 5  |     | C W       |         |    |         |     |     |     |
// | 8  | X Y |           |         |    |         |     |     |     |
// | 10 | Q   |           |         |    |         |     |     |     |
// +----+-----+-----------+---------+----+---------+-----+-----+-----+

var dutch = distribution{
	lang: language.Dutch,
	letters: []letter{
		{blank, 2, 0},
		{"A", 6, 1},
		{"B", 2, 3},
		{"C", 2, 5},
		{"D", 5, 2},
		{"E", 18, 1},
		{"F", 2, 4},
		{"G", 3, 3},
		{"H", 2, 4},
		{"I", 4, 1},
		{"J", 2, 4},
		{"K", 3, 3},
		{"L", 3, 3},
		{"M", 3, 3},
		{"N", 10, 1},
		{"O", 6, 1},
		{"P", 2, 3},
		{"Q", 1, 10},
		{"R", 5, 2},
		{"S", 5, 2},
		{"T", 5, 2},
		{"U", 3, 4},
		{"V", 2, 4},
		{"W", 2, 5},
		{"X", 1, 8},
		{"Y", 1, 8},
		{"Z", 2, 4},
	},
}

// czech represents the distribution of letters for the
// standard Czech edition. It contains 102 tiles.
// https://en.wikipedia.org/wiki/Scrabble_letter_distributions#Czech
// +----+-------+---------+-----------+---------+-------+----+
// |    | √ó1    | √ó2      | √ó3        | √ó4      | √ó5    | √ó6 |
// +----+-------+---------+-----------+---------+-------+----+
// | 0  |       | [blank] |           |         |       |    |
// | 1  |       |         | D K L P R | I S T V | A E N | O  |
// | 2  |       | √Å J Y Z | C H √ç M U |         |       |    |
// | 3  |       | B √â ƒö   |           |         |       |    |
// | 4  | ƒå ≈Æ ≈Ω | ≈ò ≈† √ù   |           |         |       |    |
// | 5  | F G √ö |         |           |         |       |    |
// | 6  | ≈á     |         |           |         |       |    |
// | 7  | √ì ≈§   |         |           |         |       |    |
// | 8  | ƒé     |         |           |         |       |    |
// | 10 | X     |         |           |         |       |    |
// +----+-------+---------+-----------+---------+-------+----+
var czech = distribution{
	lang: language.Czech,
	letters: []letter{
		{blank, 2, 0},
		{"A", 5, 1},
		{"B", 2, 3},
		{"C", 3, 2},
		{"D", 3, 1},
		{"E", 5, 1},
		{"F", 1, 5},
		{"G", 1, 5},
		{"H", 3, 2},
		{"I", 4, 1},
		{"J", 2, 2},
		{"K", 3, 1},
		{"L", 3, 1},
		{"M", 3, 2},
		{"N", 5, 1},
		{"O", 6, 1},
		{"P", 3, 1},
		{"R", 3, 1},
		{"S", 4, 1},
		{"T", 4, 1},
		{"U", 3, 1},
		{"V", 4, 1},
		{"X", 1, 10},
		{"Y", 2, 2},
		{"Z", 2, 2},
		{"√Å", 2, 2},
		{"√â", 2, 3},
		{"√ç", 3, 2},
		{"√ì", 1, 7},
		{"√ö", 1, 5},
		{"√ù", 2, 4},
		{"ƒå", 1, 4},
		{"ƒé", 1, 8},
		{"ƒö", 2, 3},
		{"≈á", 1, 6},
		{"≈ò", 2, 4},
		{"≈†", 2, 4},
		{"≈§", 1, 7},
		{"≈Æ", 1, 4},
		{"≈Ω", 1, 4},
	},
}

// icelandic represents the distribution of letters for the
// standard Icelandic edition. It contains 104 tiles.
// https://en.wikipedia.org/wiki/Scrabble_letter_distributions#Icelandic
// +----+-----------+-------------+-----+-------+----+-------+----+-----+-----+
// |    | √ó1        | √ó2          | √ó3  | √ó4    | √ó5 | √ó6    | √ó7 | √ó8  | √ó10 |
// +----+-----------+-------------+-----+-------+----+-------+----+-----+-----+
// | 0  |           | [blank]     |     |       |    |       |    |     |     |
// | 1  |           |             |     |       | T  | E S U | I  | N R | A   |
// | 2  |           |             |     | √ê G L |    |       |    |     |     |
// | 3  |           |             | F K | M     |    |       |    |     |     |
// | 4  |           | √Å D H √ç O V |     |       |    |       |    |     |     |
// | 5  | √û         |             |     |       |    |       |    |     |     |
// | 6  | B J √ì Y √Ü |             |     |       |    |       |    |     |     |
// | 8  | √â P √ö √ñ   |             |     |       |    |       |    |     |     |
// | 9  | √ù         |             |     |       |    |       |    |     |     |
// | 10 | X         |             |     |       |    |       |    |     |     |
// +----+-----------+-------------+-----+-------+----+-------+----+-----+-----+
var icelandic = distribution{
	lang: language.Icelandic,
	letters: []letter{
		{blank, 2, 0},
		{"A", 10, 1},
		{"B", 1, 6},
		{"D", 2, 4},
		{"E", 6, 1},
		{"F", 3, 3},
		{"G", 4, 2},
		{"H", 2, 4},
		{"I", 7, 1},
		{"J", 1, 6},
		{"K", 3, 3},
		{"L", 4, 2},
		{"M", 4, 3},
		{"N", 8, 1},
		{"O", 2, 4},
		{"P", 1, 8},
		{"R", 8, 1},
		{"S", 6, 1},
		{"T", 5, 1},
		{"U", 6, 1},
		{"V", 2, 4},
		{"X", 1, 10},
		{"Y", 1, 6},
		{"√Å", 2, 4},
		{"√Ü", 1, 6},
		{"√â", 1, 8},
		{"√ç", 2, 4},
		{"√ê", 4, 2},
		{"√ì", 1, 6},
		{"√ñ", 1, 8},
		{"√ö", 1, 8},
		{"√ù", 1, 9},
		{"√û", 1, 5},
	},
}

// krafla represents the distribution of letters for the
// non-standard Krafla Icelandic edition. It contains 100 tiles.
// https://en.wikipedia.org/wiki/Scrabble_letter_distributions#Icelandic
// +----+-------------+---------+-------+-----+----+-----+-------+----+-----+
// |    | √ó1          | √ó2      | √ó3    | √ó4  | √ó5 | √ó6  | √ó7    | √ó8 | √ó11 |
// +----+-------------+---------+-------+-----+----+-----+-------+----+-----+
// | 0  |             | [blank] |       |     |    |     |       |    |     |
// | 1  |             |         |       |     |    |     | I N S | R  | A   |
// | 2  |             |         | M     | √ê K | L  | T U |       |    |     |
// | 3  |             | √Å √ì     | E F G |     |    |     |       |    |     |
// | 4  | H √ç √ö       | √Ü       |       |     |    |     |       |    |     |
// | 5  | B D O P V √ù |         |       |     |    |     |       |    |     |
// | 6  | J Y √ñ       |         |       |     |    |     |       |    |     |
// | 7  | √â √û         |         |       |     |    |     |       |    |     |
// | 10 | X           |         |       |     |    |     |       |    |     |
// +----+-------------+---------+-------+-----+----+-----+-------+----+-----+
var krafla = distribution{
	lang: language.Icelandic,
	letters: []letter{
		{blank, 2, 0},
		{"A", 11, 1},
		{"B", 1, 5},
		{"D", 1, 5},
		{"E", 3, 3},
		{"F", 3, 3},
		{"G", 3, 3},
		{"H", 1, 4},
		{"I", 7, 1},
		{"J", 1, 6},
		{"K", 4, 2},
		{"L", 5, 2},
		{"M", 3, 3},
		{"N", 7, 1},
		{"O", 1, 5},
		{"P", 1, 5},
		{"R", 8, 1},
		{"S", 7, 1},
		{"T", 6, 2},
		{"U", 6, 2},
		{"V", 1, 5},
		{"X", 1, 10},
		{"Y", 1, 6},
		{"√Å", 2, 3},
		{"√Ü", 2, 4},
		{"√â", 1, 7},
		{"√ç", 1, 4},
		{"√ê", 4, 2},
		{"√ì", 2, 3},
		{"√ñ", 1, 6},
		{"√ö", 1, 4},
		{"√ù", 1, 5},
		{"√û", 1, 7},
	},
}

// afrikaans represents the distribution of letters for the
// standard Afrikaans edition. It contains 104 tiles.
// +----+-----+---------+-----+----+-----------+-----+----+-----+
// |    | √ó1  | √ó2      | √ó3  | √ó4 | √ó6        | √ó8  | √ó9 | √ó16 |
// +----+-----+---------+-----+----+-----------+-----+----+-----+
// | 0  |     | [blank] |     |    |           |     |    |     |
// | 1  |     |         |     |    | D O R S T | I N | A  | E   |
// | 2  |     |         | H L | G  |           |     |    |     |
// | 3  |     |         | K W |    |           |     |    |     |
// | 4  |     | M U Y   |     |    |           |     |    |     |
// | 5  |     | P V     |     |    |           |     |    |     |
// | 8  | B F |         |     |    |           |     |    |     |
// | 10 | J   |         |     |    |           |     |    |     |
// +----+-----+---------+-----+----+-----------+-----+----+-----+
var afrikaans = distribution{
	lang: language.Afrikaans,
	letters: []letter{
		{blank, 2, 0},
		{"A", 9, 1},
		{"B", 1, 8},
		{"D", 6, 1},
		{"E", 16, 1},
		{"F", 1, 8},
		{"G", 4, 2},
		{"H", 3, 2},
		{"I", 8, 1},
		{"J", 1, 10},
		{"K", 3, 3},
		{"L", 3, 2},
		{"M", 2, 4},
		{"N", 8, 1},
		{"O", 6, 1},
		{"P", 2, 5},
		{"R", 6, 1},
		{"S", 6, 1},
		{"T", 6, 1},
		{"U", 2, 4},
		{"V", 2, 5},
		{"W", 3, 3},
		{"Y", 2, 4},
	},
}

// bulgarian represents the distribution of letters for the
// standard Bulgarian edition. It contains 102 tiles.
// +----+-------+---------+-------+---------+----+-----+-----+
// |    | √ó1    | √ó2      | √ó3    | √ó4      | √ó5 | √ó8  | √ó9  |
// +----+-------+---------+-------+---------+----+-----+-----+
// | 0  |       | [blank] |       |         |    |     |     |
// | 1  |       |         |       | –ù –ü –† –° | –¢  | –ï –ò | –ê –û |
// | 2  |       |         | –ë –ö –õ | –í –î –ú   |    |     |     |
// | 3  |       | –™       | –ì     |         |    |     |     |
// | 4  |       | –ñ –ó     |       |         |    |     |     |
// | 5  | –ô –•   | –ß –Ø     | –£     |         |    |     |     |
// | 8  | –¶ –® –Æ |         |       |         |    |     |     |
// | 10 | –§ –© –¨ |         |       |         |    |     |     |
// +----+-------+---------+-------+---------+----+-----+-----+
var bulgarian = distribution{
	lang: language.Bulgarian,
	letters: []letter{
		{blank, 2, 0},
		{"–ê", 9, 1},
		{"–ë", 3, 2},
		{"–í", 4, 2},
		{"–ì", 3, 3},
		{"–î", 4, 2},
		{"–ï", 8, 1},
		{"–ñ", 2, 4},
		{"–ó", 2, 4},
		{"–ò", 8, 1},
		{"–ô", 1, 5},
		{"–ö", 3, 2},
		{"–õ", 3, 2},
		{"–ú", 4, 2},
		{"–ù", 4, 1},
		{"–û", 9, 1},
		{"–ü", 4, 1},
		{"–†", 4, 1},
		{"–°", 4, 1},
		{"–¢", 5, 1},
		{"–£", 3, 5},
		{"–§", 1, 10},
		{"–•", 1, 5},
		{"–¶", 1, 8},
		{"–ß", 2, 5},
		{"–®", 1, 8},
		{"–©", 1, 10},
		{"–™", 2, 3},
		{"–¨", 1, 10},
		{"–Æ", 1, 8},
		{"–Ø", 2, 5},
	},
}

// sorted by addition time
var distributions = map[string]distribution{
	"french":    french,
	"english":   english,
	"german":    german,
	"italian":   italian,
	"dutch":     dutch,
	"czech":     czech,
	"icelandic": icelandic,
	"krafla":    krafla,
	"afrikaans": afrikaans,
	"bulgarian": bulgarian,
}
